# 03장 - 케이블의 앞은 LAN 기기였다.

> ### 1. 케이블과 리피터, 허브 속을 신호가 흘러간다
- 컴퓨터에서 나온 신호는 케이블을 통해 리피터 허브 등을 경유, 신호는 흐르는 도중에 약해지거나 잡음의
영향을 받아 변형됨, 이러한 경향을 억제하는 대책

### 1) 하나하나의 패킷이 독립된 것으로 동작한다.

컴퓨터에서 송신된 패킷 → 중계장치(허브,라우터) → 목적지

- 중계장치 = 우편배달부
    - 우편배달부가 편지의 내용을 보지 않고 배달하는 것처럼 중계장치는 데이터 부분을 보지 않고 패킷을 중계함
        - 모든 패킷은 아무 관련도 없는 별개의 것으로 간주하여 중계
### 2) LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다

LAN 어댑터 → RJ-45 커넥터 → 트위스트 페어 케이블(꼰 선쌍) → 리피터 허브의 커넥터

* 송출한 신호는 케이블을 통과하는 사이에 신호의 에너지가 조금씩 떨어지므로 케이블의 길이가 길어질수록 신호가 약해지고 잡음의 영향까지 더해지면 매우 심각하게 변형됨 → 0과 1을 잘못 판독 → **통신 오류의 원인**

### 3) ‘꼼’은 잡음을 방지하기 위한 방법이다

**트위스트 페어 케이블(꼰 선쌍)** 에는 이러한 잡음의 영향을 억제하는 대책이 마련되어 있음

- 신호선을 마주 꼬아서 잡음을 막을 수 있다.
- 잡음의 원인
    - 케이블 주위에서 발생하는 전자파
- 신호
    - 전압에 의해 생기는 일종의 전류
- 잡음의 정체
    - 신호와 잡음의 전류가 뒤섞여서 신호의 파형이 변형됨

케이블에 영향을 받는 전자파는 두 종류

1. 모터, 형광등, CRT 모니터와 같은 기기에서 누설되는 전자파(케이블의 밖에서 오는것)
    - 해결방안 : 선을  꼼 으로써 막을 수 있음
2. 같은 케이블 안의 인접한 신호선에서 누설되는 전자파
    - 크로스토크(crosstalk) ⇒ 신호선 안에는 신호라는 전류가 흐르므로 전류에 의해 주위에 전자파가 생김, 이것이 다른 신호선에 대한 잡음이 됨, 이러한 잡음에 의한 영향을 크로스토크 라고 함
    - 해결방안 : 신호선을 마주 꼬는 것 외에 신호선 사이에 구분판을 넣거나 금속성의 실드(shield, 차폐) 라는 피복을 입히는 등 여러 가지 대책이 있음

### 4) 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다

신호가 `리피터 허브`에 도달하면 LAN 전체에 신호가 흩어진다. 전체에 패킷의 신호를 뿌리고 수신처 MAC 주소에 해당하는 기기만 패킷을 수신한다는 `이더넷의 기본`이라는 원리를 그대로 실현한 것

* 리피터 허브에 접속한 전체기기는 신호를 받고 수신처 MAC 주소를 조사하여 자신이 해당하는지 확인한다. → 해당하면 수신, 해당하지 않으면 무시

> ### 2. 스위칭 허브의 패킷 중계 동작
- 스위칭 허브의 동작(패킷을 운반) - 패킷의 신호를 수신 -> 디지털 데이터의 형태로 되돌린다 -> 다시 신호로 고쳐서 송신하는
동작

### 1) 스위칭 허브는 주소 테이블로 중계한다

패킷이 스위칭 허브를 경유하여 흘러갈 때 과정

1. PHY(MAU) 회로 : 케이블을 흐르는 신호의 형식을 공통의 형식으로 변환
2. MAC 회로 : 디지털 데이터로 변환한 후 패킷의 맨 끝에 있는 FCS를 대조하여 오류의 유무를 검사
3. 버퍼 메모리에 저장
- 이때 스위칭 허브의 포트는 수신처 MAC 주소를 검사하지 않고 모든 패킷을 수신하여 버퍼 메모리에 저장 → 스위칭 허브의 포트에는 LAN 어댑터와 달리 MAC 주소가 할당되어 있지 않음
1. 수신처 MAC 주소와 일치하는 것이 MAC 주소표에 등록되어 있는지 조사
2. 스위치 회로를 경유하여 송신측의 포트에 패킷을 운반
3. MAC회로나 PHY(MAU) 회로가 송신 동작을 실행
- 송신 동작중에 다른 기기가 보낸 신호가 수신측에 들어오면 패킷이 충돌하므로 재밍 신호를 보낸 후 송신 동작을 중지하고 잠시 기다렸다가 보냄

### 2) MAC 주소 테이블을 등록 및 갱신한다

스위칭 허브는 패킷을 중계할 때 MAC 주소표의 내용을 갱신하는 동작도 실행

1. 추가 : 패킷을 수신했을 때 송신처 MAC 주소를 조사하고, 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC 주소표에 등록하는것
2. 삭제 :  MAC 주소표에 등록한 정보는 사용하지 않고 일정 시간이 경과하면 삭제

⇒ 즉 MAC 주소표의 내용은 스위칭 허브 자체가 스스로 등록하거나 삭제하므로 수동으로 등록 및 삭제할 필요가 없음, MAC 주소표의 내용이 이상해진 경우에도 기기를 리셋하여 MAC 주소표의 내용을 전부 지워버리면 새롭게 주소가 등록되므로 수동 갱신할 필요X

### 3) 예외적인 동작

- 스위칭 허브는 패킷을 수신한 포트와 송신하는 포트가 같을 경우 패킷을 중계하지 않고 폐기한다.
- MAC 주소표에 수신처 MAC 주소와 일치하는 주소가 등록되어 있지 않은 경우 어느 포트에서 송신해야 할지 판단할 수 없으므로 패킷을 수신한 포트 이외의 전체 포트에서 패킷을 송신한다.
- 수신처 MAC 주소가 브로드캐스트 주소이ㄴ 경우에도 수신 포트를 제외하고 모든 포트 에서 패킷을 송신한다.

### 4) 전이중 모드에서 송신과 수신을 동시에 실행한다

- 전이중 동작 모드 ⇒ 이더넷의 신호가 흐르고 있을 때는 끝나기를 기다렸다 송신한은 동작을 실행하는 규칙을 개정하여 신호가 흐르고 있어도 송신해도 좋다는 동작 모드를 추가와 동시에 신호의 충돌을 검출하는 회로를 무효화 하기로한것

### 5) 최적의 전송 속도로 보내는 자동 조정

- 자동 조정(auto negotiation) ⇒ 접속한 상대가 전이중 모드를 지원하는지 검출, 동작모드를 자동으로 전환, 상대의 전송 속도를 검출, 전송속도도 자동으로 전환하는것
- 모드에는 우선 순위가 결정되어 있고 우선 순위가 높은 것부터 차례대로 조사하면서 자신과 상대 모두가 지원하는 것을 찾는다.

### 6) 스위칭 허브는 복수의 중계 동작을 동시에 실행한다

- `스위칭 허브`는 수신처 MAC 주소의 기기가 존재하는 포트 이외에는 송신 동작 실행X
    - 비어있는 포트에 별도의 패킷을 흘릴 수 있음 = 여러개의 패킷 중계 가능
- `리피터 허브` 는 들어온 신호를 모든 포트에서 뿌리므로 동시의 두 개 이상의 신호가 들어오면 패킷이 충돌
- 따라서 기기 전체에서 중계할 수 있는 패킷의 수 = 스위칭 허브 > 리피터 허브

> ### 3. 라우터의 패킷 중계 동작
- 라우터도 패킷을 중계하지만 라우터는 IP의 개념을 기초로 만듬 스위칭 허브는 이더넷의 구조를 기초로함 이
러한 차이점

### 1) 라우터의 기본

- 리피터 허브, 스위칭 허브를 경유한 패킷은 라우터에 도착
- 중계 부분과 포트 부분으로 구성됨
- 중계부분 → 패킷의 중계 대상을 판단하는 동작 담당
- 포트부분 → 패킷을 송 수신하는 동작을 담당
- 라우터의 중계 부분은 IP 담당 부분과 같고 포트 부분은 LAN 어댑터와 같다
- 포트 부분에 하드웨어를 장착하면 다양한 통신 기술을 지원 할 수 있다.

라우터의 내부 구조

- 포트 부분이 패킷의 송신처 또는 수신처가 되어 패킷을 송 수신한다.
- 라우터의 각 포트에는 MAC 주소와 IP 주소가 할당되어 있다.

### 2) 경로표에 등록된 정보

- 라우터는 IP 헤더에 기재되어 있는 수신처 IP 주소로 중계 대상을 판단한다.
- 라우터의 테이블은 라우팅 테이블 또는 경로표 라고 부른다
    - 수신처 : 수신처의 정보
    - 넷마스크
    - 게이트웨이 : 패킷의 중계 대상
    - 인터페이스 : 패킷의 중계 대상
    - 메트릭 : 수신처 IP 주소에 기록되어 있는 목적지가 가까운지, 먼지를 나타낸다
- 주소집약을 이용하면 몇 개의 서브넷을 모아서 한 개의 서브넷으로 간주한 후 묶은 서브넷을 경로표에 등록할 수 있다
- 복수의 서브넷을 하나인 것으로 간주하기 위해 넷마스크 값을 변경하여 경로표에 등록하고 수신처 항목에 집약한 주소를 등록한다
- 라우터의 경로표에 경로 정보를 등록하는 방법은 크게 두가지로 분류
    - 사람이 수동으로 경로 정보를 등록/갱신
    - 라우팅 프로토콜 이라는 구조를 사용하여 라우터들끼리 경로 정보를 교환하고 라우터가 자체에서 경로표에 등록

### 3) 라우터의 패킷 수신 동작

1. 신호가 커넥터 부분에 도착
2. PHY(MAU) 회로와 MAC 회로에서 신호를 디지털 데이터로 변환
3. 패킷 끝부분의 FCS를 대조하여 오류의 유무를 점검
4. 정상이면 MAC 헤더의 수신처 MAC 주소가 자신에게 해당하는지 조사
5. 해당하면 패킷을 수신 버퍼 메모리에 저장
6. 주소가 해당하지 않으면 패킷을 폐기
- 라우터의 포트에는 MAC 주소가 할당되어 있으며, 라우터는 자신의 주소에 해당하는 패킷만 수신, 해당하지 않는 패킷을 폐기

### 4) 경로표를 검색하여 출력 포트를 발견한다

- 라우터는 MAC 헤더의 뒤에 있는 IP 헤더의 내용을 보고 패킷 중계동작에 들어간다.
- 수신한 패킷의 수신처 IP 주소와 경로표의 수신처 항목을 조사하여 해당하는 행을 찾는다.

### 5) 해당하는 경로가 없는 경우에 선택하는 기본 경로

- 넷마스크 항목을 0.0.0.0으로 하면 모든 주소에 일치 하기 때문에 중계 대상이 분명하지 않다는 사태가 발생하지 않는다.
    - 이 행의 게이트웨이 항목에 인터넷으로 나가는 라우터를 등록해 두면 다른 행에 해당하는 것이 없는 경우에는 패킷을 그곳으로 중계한다.
    - 이 행을 기본 경로 라고 하며, 여기에 등록한 라우터를 기본 게이트웨이 라고 한다.


### 6) 패킷은 유효 기한이 있다

- TTL(Time To Live, 생존 기간) 이란 필드는 패킷의 생존 기간을 나타낸다. 라우터를 경유할 때마다 이 값을 1씩 줄이다가 숫자가 0이 되면 패킷의 생존기간이 만료되는 것으로 간주하여 패킷을 폐기한다.
- 패킷이 같은 장소를 뱅글뱅글 순환하는 사태를 막기 위한 것
- 현재의 인터넷은 지구의 반대편까지 액세스해도 경유하는 라우터 수가 많아야 수십개 정도

### 7) 큰 패킷은 조각 나누기 기능으로 분할한다

- 어느 경우든지 중계하는 패킷의 크기가 출력측의 패킷 최대 길이를 초과하면 그대로는 패킷을 송신할 수 없다.
- 이 경우에는 IP 프로토콜에 규정된 조각 나누기(fragmentation)라는 방법을 사용하여 패킷을 분할, 패킷의 길이를 짧게 만든 후 중계한다.
- 패킷이 만들어진 후에 패킷을 분할하는 것을 가리킴

조각나누기 동작 과정

1. MTU(한개의 패킷으로 운반할 수 있는 최대 길이) 조사
2. 데이터 부분을 맨 앞부분부터 차례대로 잘라냄
3. 데이터를 분할하면 IP 헤더를 덧붙임

### 8) 라우터의 송신 동작은 컴퓨터와 같다

출력측의 포트가 이더넷인 경우의 송신 동작

- 패킷의 맨 앞부분에 MAC 헤더를 부가 → 값을 설정해 패킷을 완성 → 전기 신호로 변환해서 보낸다.

### 9) 라우터와 스위칭 허브의 관계

- 라우터는 IP 개념에 기초
- 스위칭 허브는 이더넷에 기초
- IP와 이더넷의 관계가 라우터와 스위칭 허브의 관계를 나타낸다.
    - 라우터 ⇒ 패킷을 운반하는 일을 스위칭 허브에 의뢰한다.
- 통신 상대까지 패킷을 전달하는 전체의 동작은 IP(라우터)가 담당 하고 이 동작을 할 때 다음 라우터까지 패킷을 운반하는 부분은 이더넷(스위칭 허브)가 담당하는 것

> ### 4. 라우터의 부가 기능
- 인터넷의 출입구에 배치하는 라우터의 주소 변환 기능(프라이비트 주소 -> 글로벌 주소로 변환)과 패킷 필터링
기능(위험한 패킷을 차단)

### 1) 주소 변환으로 IP 주소를 효율적으로 이용한다

- 주소 변환 - 사내 네트워크엠는 프라이비트 주소를 할당하고 인터넷과는 직접 패킷을 주고받지 않도록 특별한 구조를 사용하여 접속하는 구조
- 패킷 필터링 - 패킷을 중계할 때 MAC 헤더, IP 헤더, TCP 헤더에 기록되어 있는 내용을 조사하여 그것이 사전에 설정한 조건에 합치되면 패킷을 중계하거나 폐기하는 동작을 실행한다.
- 프라이비트 주소(private address) - 두 회사가 같은 주소를 사용했어도 네트워크가 독립되어 있으면 문제가 일어나지 않는다는 성질을 이용해서 만든 규칙에 기초한 사내용 주소
- 글로벌 주소(global address) - 이전 의 고유한 주소